# E2.3 – Room Processor Handler Backlog

**Status:** 95% Complete - January 21, 2026

**Completed:**
- 11/11 handler families implemented
- 240/240 tests passing
- All room-level intent processing complete

**Blocked by E5 (Global Systems):**
- PWR_GENERATE_OPS power ability (needs global power balance)
- User power balance tracking in PowerSpawn
- User GCL updates in Controller
- Boost effects GCL component in Controller

See `docs/engine/e5-plan.md` for E5 blocker details and implementation plan.

---

## Completed Handlers ✅

The following intent handlers are fully implemented and tested:

### Core Creep Actions
- ✅ **Movement** - `MovementIntentStep` (includes crashes, pull chains, inter-room transfers, portal transfers)
- ✅ **Spawning** - `SpawnIntentStep` (create, renew, recycle with stats/tombstones)
- ✅ **Lifecycle** - `CreepLifecycleStep` (TTL expiration, zero-hit cleanup, user-summoned despawn)
- ✅ **Build/Repair** - `CreepBuildRepairStep` (construction sites, structure repairs with blueprint integration)
- ✅ **Harvesting** - `HarvestIntentStep` (sources, minerals, deposits with overflow drops)

### Structure Actions
- ✅ **Towers** - `TowerIntentStep` (attack, heal, repair with range falloff)

### Resource I/O ✅
- ✅ **Transfer/Withdraw/Pickup/Drop** - `ResourceTransferIntentStep` (31/31 tests, lab capacity tracking, power effects)

### Core Controller Actions ✅
- ✅ **Controller** - `ControllerIntentStep` (12/12 tests, upgrade, reserve, attack with level transitions)
  - ✅ SafeMode available tracking (parity-critical)
  - ⚠️ Boost effects - Progress calculation complete, GCL updates blocked by E5

### Lab Reactions & Boosts ✅
- ✅ **Lab Reactions & Boosts** - `LabIntentStep` (27/27 tests, runReaction with 62 formulas, boostCreep with 40 boost types, unboostCreep with mineral returns, cooldown tracking, capacity management, action log recording, PWR_OPERATE_LAB effect support)

### Structure Energy Routing ✅
- ✅ **Link Energy Transfer** - `LinkIntentStep` (8/8 tests, energy transfers between links with 3% loss ratio, distance-based cooldowns, action log recording)
- ✅ **Power Spawn Processing** - `PowerSpawnIntentStep` (9/9 tests, consumes 1 power + 50 energy per tick to generate ops, PWR_OPERATE_POWER effect support)
- ✅ **Factory Production** - `FactoryIntentStep` (11/11 tests, commodity production with 62 recipes, multi-component consumption, level gating, cumulative cooldowns, action log recording, PWR_OPERATE_FACTORY effect support)

### Global/Power Creep Handlers
- ✅ **Power Creep Lifecycle** - `PowerCreepIntentStep` (create, delete, rename, suicide, spawn, upgrade)
- ✅ **Power Creep Abilities** - `PowerAbilityStep` (58/58 tests: 4 decay + 10 core + 32 effect-based + 12 direct-action)
  - ✅ Effect decay logic (`PowerEffectDecayStep`)
  - ✅ All 18 power abilities implemented (generateOps deferred to E5)
  - ⚠️ generateOps ability - Blocked by E5 (requires global power balance tracking)
- ✅ **Market** - `MarketIntentStep` (orders, deals, terminal sends, NPC maintenance)
- ✅ **Inter-Room Transfers** - `InterRoomTransferStep` (edge exits, portal transfers, room activations)

### Infrastructure
- ✅ **Stats/Telemetry** - `RoomStatsSink`, `RoomStatsPipeline`, `GlobalMutationWriter`
- ✅ **Death Processing** - `ICreepDeathProcessor` (drops, tombstones, stats centralized)
- ✅ **Blueprint System** - `StructureBlueprintRegistry` (structure metadata, decay timers, capacities)
- ✅ **Driver Contracts** - All DTOs, mappers, and mutation payloads in place

---

## Deferred Features

### Parity-Critical (Blocked by E5)
These features require E5 (Global Systems) infrastructure. See `docs/engine/e5-plan.md` for implementation details.

1. **PWR_GENERATE_OPS** - Power ability to generate ops from global power balance
2. **User power balance tracking** - PowerSpawn should increment user's global power balance
3. **User GCL updates** - Controller upgrades should accumulate GCL (both boosted and non-boosted)
4. **Boost effects GCL component** - Boosted upgrades should give boosted GCL gains

### Non-Parity-Critical (Future Work)
These features don't affect simulation correctness and can be implemented post-E7:

1. **Event log emission** - EVENT_TRANSFER, EVENT_UPGRADE_CONTROLLER, etc. for replay visualization
2. **Level-up notifications** - User notifications on controller level-up
3. **Stats recording** - Track power processed, resources transferred, etc. for statistics

---

## Test Coverage Summary

**Total:** 240/240 tests passing

| Handler Family | Tests | Status |
|----------------|-------|--------|
| Movement | 25 | ✅ Complete |
| Spawn | 18 | ✅ Complete |
| Build/Repair | 12 | ✅ Complete |
| Harvest | 15 | ✅ Complete |
| Tower | 10 | ✅ Complete |
| Resource I/O | 31 | ✅ Complete |
| Controller | 12 | ✅ Complete |
| Lab | 27 | ✅ Complete |
| Link | 8 | ✅ Complete |
| Power Spawn | 9 | ✅ Complete |
| Factory | 11 | ✅ Complete |
| Power Abilities | 58 | ✅ Complete |
| Market | 4 | ✅ Complete |

---

## References

- **Node.js Engine:** `/home/th3b0y/screeps-rewrite/ScreepsNodeJs/engine/src/processor/intents/`
- **Implementation Plan:** `.claude/plans/agile-churning-barto-agent-a7b1b45.md`
- **Driver Contracts:** `src/ScreepsDotNet.Driver/Contracts/`
- **Engine CLAUDE.md:** `src/ScreepsDotNet.Engine/CLAUDE.md`
- **E5 Plan (Blockers):** `docs/engine/e5-plan.md` - Lists E2.3 features blocked by E5, implementation order after E5 Phase 1/2 complete

---

**Last Updated:** January 21, 2026 (Plan condensed - removed verbose implementation details)
