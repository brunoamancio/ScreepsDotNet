# E2.3 – Room Processor Handler Backlog

**Status:** Updated January 20, 2026

This document tracks the remaining intent handlers needed to complete E2.3 ("Wire engine consumption"). Once all handlers are ported from the Node.js engine, the .NET engine will be feature-complete for single-room simulation.

---

## Completed Handlers ✅

The following intent handlers are fully implemented and tested:

### Core Creep Actions
- ✅ **Movement** - `MovementIntentStep` (includes crashes, pull chains, inter-room transfers, portal transfers)
- ✅ **Spawning** - `SpawnIntentStep` (create, renew, recycle with stats/tombstones)
- ✅ **Lifecycle** - `CreepLifecycleStep` (TTL expiration, zero-hit cleanup, user-summoned despawn)
- ✅ **Build/Repair** - `CreepBuildRepairStep` (construction sites, structure repairs with blueprint integration)
- ✅ **Harvesting** - `HarvestIntentStep` (sources, minerals, deposits with overflow drops)

### Structure Actions
- ✅ **Towers** - `TowerIntentStep` (attack, heal, repair with range falloff)

### Resource I/O ✅
- ✅ **Transfer/Withdraw/Pickup/Drop** - `ResourceTransferIntentStep` (31/31 tests, lab capacity tracking, power effects)

### Global/Power Creep Handlers
- ✅ **Power Creep Lifecycle** - `PowerCreepIntentStep` (create, delete, rename, suicide, spawn, upgrade)
- ✅ **Market** - `MarketIntentStep` (orders, deals, terminal sends, NPC maintenance)
- ✅ **Inter-Room Transfers** - `InterRoomTransferStep` (edge exits, portal transfers, room activations)

### Infrastructure
- ✅ **Stats/Telemetry** - `RoomStatsSink`, `RoomStatsPipeline`, `GlobalMutationWriter`
- ✅ **Death Processing** - `ICreepDeathProcessor` (drops, tombstones, stats centralized)
- ✅ **Blueprint System** - `StructureBlueprintRegistry` (structure metadata, decay timers, capacities)
- ✅ **Driver Contracts** - All DTOs, mappers, and mutation payloads in place

---

## Remaining Handlers ☐

The following handlers must be implemented to complete E2.3:

### 1. Controller Intents (High Priority)
**Ready to implement** - All dependencies met (Resource I/O complete)

- ☐ `ControllerIntentStep` to handle:
  - `upgradeController` - Consume energy, increment progress, handle RCL upgrades
  - `reserveController` - Set reservation timer and owner
  - `attackController` - Reduce reservation timer and progress

**Estimated effort:** 2-3 days
**Tests needed:** ~12 tests (upgrade power, RCL transitions, reservation, attacks, edge cases)

### 2. Lab Reactions & Boosts (High Priority)
**Ready to implement** - Lab capacity tracking complete (`StoreCapacityResource` implemented)

- ☐ `LabIntentStep` to handle:
  - `runReaction` - Consume reagents, produce compounds, set cooldown
  - `boostCreep` - Apply boost effects, consume minerals, update creep body parts

**Estimated effort:** 3-4 days
**Tests needed:** ~15 tests (reactions, reagent validation, cooldowns, boost application, mineral consumption)

**Remaining prerequisites:**
- Add `BoostEffect` fields to `RoomObjectSnapshot` (creep body parts)

### 3. Structure Energy Routing (Medium Priority)

- ☐ `LinkIntentStep` - Energy transfers between links with cooldowns
- ☐ `FactoryIntentStep` - Commodity production with cooldowns/reagents
- ☐ `PowerSpawnIntentStep` - Process power into ops

**Estimated effort:** 4-5 days
**Tests needed:** ~20 tests total

### 4. Power Creep Abilities (Low Priority)
**Ready to implement** - Power effect types complete (`PowerEffectTypes` constants implemented)

- ☐ `PowerCreepAbilityStep` to handle 19 power abilities:
  - `generateOps`, `operateSpawn`, `operateTower`, `operateStorage`, etc.
  - Each ability has unique validation, cooldowns, ranges, and effects

**Estimated effort:** 7-10 days
**Tests needed:** ~40+ tests (2-3 per ability)

**Remaining prerequisites:**
- Add effect duration/magnitude tracking to `RoomObjectSnapshot`
- Implement power effect decay logic

---

---

## Known Limitations / Deferred Features

The following features were intentionally deferred from Resource I/O implementation as they are **not blocking MVP** and can be added later:

### Event Emission (Deferred)
**Impact:** Low - Event logs are used for replays/debugging, not core simulation

Transfer and withdraw operations currently do not emit `EVENT_TRANSFER` events to the event log. The Node.js engine emits these for replay visualization:

```javascript
// Node.js emits:
eventLog.push({
    event: C.EVENT_TRANSFER,
    objectId: source._id,
    data: {targetId: target._id, resourceType: resourceType, amount}
});
```

**What's needed:**
1. Add `TransferEvent` record to `RoomProcessorContext`
2. Implement `RecordTransferEvent(sourceId, targetId, resourceType, amount)` method
3. Call from `ProcessTransfer` (creep → target) and `ProcessWithdraw` (target → creep, reversed)
4. Extend `RoomIntentEventLogStep` to serialize transfer events to `ActionLog`

**Tracking:** See `.claude/plans/agile-churning-barto-agent-a7b1b45.md` Phase 3

### XML Documentation (Deferred)
**Impact:** Low - Code is readable without XML docs, can add incrementally

Public methods in `ResourceTransferIntentStep` do not have XML documentation comments. Private validation/mutation helpers are well-named and self-documenting.

**What's needed:**
- Add `<summary>`, `<param>`, `<returns>` tags to public methods
- Document complex validation logic (rampart blocking, lab capacity tracking)

**Note:** This is standard tech debt that can be addressed during maintenance cycles.

---

## Next Steps (Priority Order)

### ✅ Completed (January 19-20, 2026)
1. ✅ Complete Resource I/O handler (transfer, withdraw, pickup, drop)
2. ✅ Add infrastructure for lab capacity tracking and power effects
3. ✅ Complete all 31 Resource I/O tests

### Short Term (Next 2 Weeks)
4. ☐ Implement `ControllerIntentStep` (upgrade, reserve, attack)
5. ☐ Implement basic lab reactions (without boost support initially)

### Medium Term (Next Month)
7. ☐ Implement structure energy routing (links, factory, power spawn)
8. ☐ Complete lab boost support
9. ☐ Begin power creep ability handlers (highest-value abilities first)

### Long Term
10. ☐ Complete all power creep ability handlers
11. ☐ E7 parity validation (lockstep testing vs Node.js engine)

---

## Test Coverage Summary

| Handler | Tests Written | Tests Passing | Deferred | Coverage |
|---------|---------------|---------------|----------|----------|
| Movement | 25 | 25 | 0 | ✅ Complete |
| Spawn | 18 | 18 | 0 | ✅ Complete |
| Build/Repair | 12 | 12 | 0 | ✅ Complete |
| Harvest | 15 | 15 | 0 | ✅ Complete |
| Tower | 10 | 10 | 0 | ✅ Complete |
| **Resource I/O** | **31** | **31** | **0** | ✅ **Complete** |
| Controller | 0 | 0 | 0 | ☐ Not started |
| Lab | 0 | 0 | 0 | ☐ Not started |
| Power Abilities | 0 | 0 | 0 | ☐ Not started |

**Overall E2.3 Progress:** ~75% complete (8/10 major handler families implemented)

---

## References

- **Node.js Engine:** `/home/th3b0y/screeps-rewrite/ScreepsNodeJs/engine/src/processor/intents/`
- **Implementation Plan:** `.claude/plans/agile-churning-barto-agent-a7b1b45.md`
- **Driver Contracts:** `src/ScreepsDotNet.Driver/Contracts/`
- **Engine CLAUDE.md:** `src/ScreepsDotNet.Engine/CLAUDE.md`

---

**Last Updated:** January 20, 2026
